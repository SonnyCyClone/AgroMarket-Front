<!--
  P√°gina de Gesti√≥n de Productos - AgroMarket
  
  Template principal para la administraci√≥n de productos.
  Incluye sidebar de filtros, controles de ordenamiento y grid de productos
  con funcionalidades de edici√≥n habilitadas.
-->

<div class="products-manage-container">
  <!-- Header de la p√°gina -->
  <header class="page-header">
    <h1 class="page-title">Gesti√≥n de Productos</h1>
    <p class="page-subtitle">Administra tu cat√°logo de productos agr√≠colas</p>
  </header>

  <!-- Contenido principal -->
  <div class="main-content">
    <!-- Sidebar de filtros -->
    <aside class="sidebar-container">
      <app-sidebar-filter></app-sidebar-filter>
    </aside>

    <!-- √Årea principal de productos -->
    <main class="products-area">
      <!-- Controles superiores -->
      <div class="products-controls" id="products-controls-manage">
        <!-- Selector de ordenamiento -->
        <div class="sort-control">
          <label for="sort-select-manage" class="sort-label">Ordenar por:</label>
          <select 
            id="sort-select-manage" 
            class="sort-select"
            [value]="sortOption"
            (change)="onSortChange($event)">
            @for (option of sortOptions; track option.value) {
              <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>

        <!-- Contador de productos -->
        <div class="products-count" id="products-count-manage">
          <span class="count-text">
            {{ products.length }} 
            {{ products.length === 1 ? 'producto encontrado' : 'productos encontrados' }}
          </span>
        </div>
      </div>

      <!-- Grid de productos -->
      <section class="products-grid" id="products-grid-manage">
        <!-- Estado de carga -->
        @if (loading) {
          <div class="loading-state" id="loading-manage">
            <div class="loading-spinner"></div>
            <p class="loading-text">Cargando productos...</p>
          </div>
        }

        <!-- Estado de error -->
        @else if (errorMessage) {
          <div class="error-state" id="error-manage">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h3 class="error-title">Error al cargar productos</h3>
            <p class="error-message">{{ errorMessage }}</p>
            <button 
              type="button" 
              class="retry-button"
              id="retry-button-manage"
              (click)="retryLoadProducts()">
              Reintentar
            </button>
          </div>
        }

        <!-- Lista de productos con controles de edici√≥n -->
        @else if (products.length > 0) {
          @for (product of products; track trackByProductId($index, product)) {
            <app-product-card
              [product]="product"
              [canEdit]="canEditProducts()"
              (editProduct)="onEditProduct($event)"
              [attr.id]="'product-card-manage-' + product.id">
            </app-product-card>
          }
        }

        <!-- Estado vac√≠o -->
        @else {
          <div class="empty-state" id="empty-manage">
            <div class="empty-icon">üì¶</div>
            <h3 class="empty-title">No hay productos disponibles</h3>
            <p class="empty-message">
              A√∫n no tienes productos registrados. 
              <br>¬°Comienza agregando tu primer producto!
            </p>
          </div>
        }
      </section>
    </main>
  </div>

  <!-- Modal de edici√≥n de producto -->
  @if (currentEditProduct) {
    <app-edit-product-modal
      [product]="currentEditProduct"
      [isOpen]="showEditModal"
      (modalClose)="onModalClose($event)">
    </app-edit-product-modal>
  }

  <!-- Mensajes de notificaci√≥n -->
  
  <!-- Mensaje de √©xito -->
  @if (showSuccessMessage) {
    <div 
      class="notification success-notification"
      id="success-notification-manage"
      role="alert"
      aria-live="polite">
      <div class="notification-content">
        <span class="notification-icon">‚úÖ</span>
        <span class="notification-message">{{ successMessage }}</span>
        <button 
          type="button"
          class="notification-close"
          id="success-close-manage"
          (click)="dismissSuccessMessage()"
          aria-label="Cerrar mensaje de √©xito">
          ‚úï
        </button>
      </div>
    </div>
  }

  <!-- Mensaje de error -->
  @if (showErrorMessage) {
    <div 
      class="notification error-notification"
      id="error-notification-manage"
      role="alert"
      aria-live="assertive">
      <div class="notification-content">
        <span class="notification-icon">‚ùå</span>
        <span class="notification-message">{{ modalErrorMessage }}</span>
        <button 
          type="button"
          class="notification-close"
          id="error-close-manage"
          (click)="dismissErrorMessage()"
          aria-label="Cerrar mensaje de error">
          ‚úï
        </button>
      </div>
    </div>
  }
</div>
