<div class="register-product-page">
  <div class="register-container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando formulario...</p>
    </div>

    <!-- Main Form -->
    <div *ngIf="!isLoading" class="register-card">
      <div class="register-header">
        <h1>Registrar Nuevo Producto</h1>
        <p>Agregar un nuevo producto al catálogo de AgroMarket</p>
      </div>
      
      <form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="register-form">
        <div class="form-row">
          <div class="form-group">
            <label for="variedad">Variedad *</label>
            <input
              type="text"
              id="variedad"
              formControlName="variedad"
              class="form-input"
              [class.error]="getFieldError('variedad')"
              placeholder="Ej: Tomate Cherry, Lechuga Romana"
            >
            <div class="error-message" *ngIf="getFieldError('variedad')">
              {{ getFieldError('variedad') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="precio">Precio (COP) *</label>
            <input
              type="number"
              id="precio"
              formControlName="precio"
              class="form-input"
              [class.error]="getFieldError('precio')"
              placeholder="0"
              min="1"
            >
            <div class="price-preview" *ngIf="productForm.get('precio')?.value > 0">
              {{ formatPrice(productForm.get('precio')?.value) }}
            </div>
            <div class="error-message" *ngIf="getFieldError('precio')">
              {{ getFieldError('precio') }}
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="cantidadDisponible">Cantidad Disponible *</label>
            <input
              type="number"
              id="cantidadDisponible"
              formControlName="cantidadDisponible"
              class="form-input"
              [class.error]="getFieldError('cantidadDisponible')"
              placeholder="1"
              min="1"
            >
            <div class="error-message" *ngIf="getFieldError('cantidadDisponible')">
              {{ getFieldError('cantidadDisponible') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="unidadesId">Unidad *</label>
            <select
              id="unidadesId"
              formControlName="unidadesId"
              class="form-input"
              [class.error]="getFieldError('unidadesId')"
            >
              <option value="">Seleccione una unidad</option>
              <option *ngFor="let unidad of unidades" [value]="unidad.id">
                {{ unidad.nombre }} ({{ unidad.abreviatura }})
              </option>
            </select>
            <div class="error-message" *ngIf="getFieldError('unidadesId')">
              {{ getFieldError('unidadesId') }}
            </div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="categoriaId">Categoría *</label>
            <select
              id="categoriaId"
              formControlName="categoriaId"
              class="form-input"
              [class.error]="getFieldError('categoriaId')"
            >
              <option value="">Seleccione una categoría</option>
              <option *ngFor="let categoria of categorias" [value]="categoria.id">
                {{ categoria.nombre }}
              </option>
            </select>
            <div class="error-message" *ngIf="getFieldError('categoriaId')">
              {{ getFieldError('categoriaId') }}
            </div>
          </div>
          
          <div class="form-group">
            <label for="idTipoProducto">Tipo de Producto *</label>
            <select
              id="idTipoProducto"
              formControlName="idTipoProducto"
              class="form-input"
              [class.error]="getFieldError('idTipoProducto')"
              [disabled]="!productForm.get('categoriaId')?.value"
            >
              <option value="">Seleccione un tipo</option>
              <option *ngFor="let tipo of tiposProducto" [value]="tipo.id">
                {{ tipo.nombre }}
              </option>
            </select>
            <div class="error-message" *ngIf="getFieldError('idTipoProducto')">
              {{ getFieldError('idTipoProducto') }}
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="imagenUrl">URL de la Imagen *</label>
          <input
            type="url"
            id="imagenUrl"
            formControlName="imagenUrl"
            class="form-input"
            [class.error]="getFieldError('imagenUrl')"
            placeholder="https://ejemplo.com/imagen-producto.jpg"
          >
          <div class="error-message" *ngIf="getFieldError('imagenUrl')">
            {{ getFieldError('imagenUrl') }}
          </div>
        </div>
        
        <div class="form-group">
          <label for="descripcion">Descripción *</label>
          <textarea
            id="descripcion"
            formControlName="descripcion"
            class="form-textarea"
            [class.error]="getFieldError('descripcion')"
            placeholder="Ingrese una descripción detallada del producto"
            rows="4"
          ></textarea>
          <div class="error-message" *ngIf="getFieldError('descripcion')">
            {{ getFieldError('descripcion') }}
          </div>
        </div>

        <div class="form-group checkbox-group">
          <label class="checkbox-label">
            <input
              id="activo"
              type="checkbox"
              formControlName="activo"
              class="checkbox-input"
            >
            <span class="checkbox-text">Producto activo</span>
          </label>
        </div>
        
        <div class="form-actions">
          <button 
            id="reset"
            type="button" 
            class="secondary-button"
            [disabled]="isSubmitting"
            (click)="productForm.reset()"
          >
            Limpiar
          </button>
          <button 
            id="submitproduct"
            type="submit" 
            class="primary-button"
            [disabled]="!productForm.valid || isSubmitting"
          >
            <span *ngIf="!isSubmitting">Registrar Producto</span>
            <span *ngIf="isSubmitting">Registrando...</span>
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Success Dialog -->
  <app-confirm-dialog
    [isVisible]="showConfirmDialog"
    title="Éxito"
    message="Producto registrado exitosamente"
    confirmText="Aceptar"
    (confirmed)="onConfirmDialogClose()"
    (closed)="onConfirmDialogClose()"
  ></app-confirm-dialog>

  <!-- Error Dialog -->
  <app-confirm-dialog
    [isVisible]="showError"
    title="Error"
    [message]="errorMessage"
    confirmText="Cerrar"
    (confirmed)="onErrorDialogClose()"
    (closed)="onErrorDialogClose()"
  ></app-confirm-dialog>
</div>
