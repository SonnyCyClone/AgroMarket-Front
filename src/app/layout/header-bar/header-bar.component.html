<header class="header">
  <div class="header-container">
    <div class="logo-section">
      <div 
        id="header-logo-wrapper"
        class="logo-wrapper"
        (click)="onLogoClick()"
        role="button"
        tabindex="0"
        (keydown.enter)="onLogoClick()"
        (keydown.space)="onLogoClick()"
        aria-label="Ir al inicio"
      >
        <img 
          id="header-logo" 
          [src]="logoUrl" 
          alt="Logo AgroMarket" 
          (error)="onHeaderLogoError($event)"
          class="logo-icon"
        />
        <h1 class="logo">AgroMarket</h1>
      </div>
    </div>
    
    <div class="search-section">
      <app-search-bar></app-search-bar>
    </div>
    
    <div class="actions-section">
      <!-- Admin Dropdown for Product Management -->
      <div *ngIf="canManageProducts" class="admin-dropdown-container">
        <button 
          id="header-admin-dropdown-button"
          class="admin-button"
          (click)="onAdminDropdownToggle($event)"
          aria-label="AdministraciÃ³n de productos"
          aria-expanded="{{showAdminDropdown}}"
          aria-haspopup="menu"
        >
          <span class="icon">âš™ï¸</span>
          <span class="label">AdministraciÃ³n</span>
          <span class="dropdown-arrow">â–¼</span>
        </button>
        
        <div 
          *ngIf="showAdminDropdown" 
          class="admin-dropdown"
          role="menu"
          aria-label="MenÃº de administraciÃ³n de productos"
        >
          <button 
            id="header-register-product-dropdown-button"
            class="dropdown-item" 
            (click)="onRegisterProductClick()"
            role="menuitem"
          >
            <span class="dropdown-icon">â•</span>
            Registrar Producto
          </button>
          <button 
            id="header-manage-products-dropdown-button"
            class="dropdown-item" 
            (click)="onManageProductsClick()"
            role="menuitem"
          >
            <span class="dropdown-icon">ğŸ“</span>
            Actualizar Productos
          </button>
        </div>
      </div>
      
      <button 
        id="header-cart-button"
        class="icon-button cart-button" 
        (click)="onCartClick()"
        aria-label="Ver carrito de compras"
      >
        <span class="icon">ğŸ›’</span>
        <span class="label">Carrito</span>
        <span *ngIf="cartItemCount > 0" class="cart-badge" id="header-cart-badge">
          {{ cartItemCount }}
        </span>
      </button>
      
      <div class="user-actions">
        <!-- User Dropdown for Non-Logged Users -->
        <div *ngIf="!isLoggedIn" class="user-dropdown-container">
          <button 
            id="header-user-dropdown-button"
            class="icon-button user-button"
            (click)="onUserDropdownToggle($event)"
            (mouseenter)="showUserDropdown = true"
            aria-label="Opciones de usuario"
            aria-expanded="{{showUserDropdown}}"
            aria-haspopup="menu"
          >
            <span class="icon">ğŸ‘¤</span>
            <span class="label">Cuenta</span>
            <span class="dropdown-arrow">â–¼</span>
          </button>
          
          <div 
            *ngIf="showUserDropdown" 
            class="user-dropdown"
            (mouseleave)="showUserDropdown = false"
            role="menu"
            aria-label="MenÃº de opciones de usuario"
          >
            <button 
              id="header-login-dropdown-button"
              class="dropdown-item" 
              (click)="onLoginClick()"
              (keydown.enter)="onLoginClick()"
              (keydown.space)="onLoginClick()"
              role="menuitem"
            >
              <span class="dropdown-icon">ğŸ”‘</span>
              Iniciar SesiÃ³n
            </button>
            <button 
              id="header-register-dropdown-button"
              class="dropdown-item" 
              (click)="onRegisterClick()"
              (keydown.enter)="onRegisterClick()"
              (keydown.space)="onRegisterClick()"
              role="menuitem"
            >
              <span class="dropdown-icon">ğŸ”“</span>
              Crear Cuenta
            </button>
          </div>
        </div>
        
        <!-- Logged User Menu -->
        <div *ngIf="isLoggedIn" class="user-menu">
          <div class="user-dropdown-container">
            <button 
              id="header-logged-user-dropdown-button"
              class="icon-button user-button"
              (click)="onUserDropdownToggle($event)"
              aria-label="MenÃº de usuario"
              aria-expanded="{{showUserDropdown}}"
              aria-haspopup="menu"
            >
              <span class="icon">ğŸ‘¤</span>
              <span class="user-name">{{ userDisplayName }}</span>
              <span class="dropdown-arrow">â–¼</span>
            </button>
            
            <div 
              *ngIf="showUserDropdown" 
              class="user-dropdown"
              role="menu"
              aria-label="MenÃº de opciones de usuario loggeado"
            >
              <button 
                id="header-profile-dropdown-button"
                class="dropdown-item" 
                (click)="onProfileClick()"
                role="menuitem"
              >
                <span class="dropdown-icon">ğŸ‘¤</span>
                Mi Perfil
              </button>
              <button 
                id="header-orders-dropdown-button"
                class="dropdown-item" 
                (click)="onOrdersClick()"
                role="menuitem"
              >
                <span class="dropdown-icon">ğŸ“¦</span>
                Mis Compras
              </button>
              <button 
                id="header-faq-dropdown-button"
                class="dropdown-item" 
                (click)="onFaqClick()"
                role="menuitem"
              >
                <span class="dropdown-icon">â“</span>
                Preguntas frecuentes
              </button>
              <button 
                id="header-support-dropdown-button"
                class="dropdown-item" 
                (click)="onSupportClick()"
                role="menuitem"
              >
                <span class="dropdown-icon">ğŸ’¬</span>
                Soporte
              </button>
              <button 
                id="header-logout-dropdown-button"
                class="dropdown-item" 
                (click)="onLogout()"
                role="menuitem"
              >
                <span class="dropdown-icon">ğŸšª</span>
                Cerrar SesiÃ³n
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
