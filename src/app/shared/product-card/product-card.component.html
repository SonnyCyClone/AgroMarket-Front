<!-- 
  Tarjeta de producto para AgroMarket
  
  Componente reutilizable que muestra informaci贸n de producto en formato tarjeta.
  Compatible con productos API (nuevo formato) y legacy (formato anterior).
  Incluye manejo robusto de im谩genes con fallback a placeholder.
-->
<div class="product-card" (click)="onViewProduct()">
  <div class="product-image-container">
    <img 
      *ngIf="!imageError && getImageUrl()"
      [src]="getImageUrl()" 
      [alt]="getName()"
      class="product-image"
      (error)="onImageError($event)"
    >
    <div *ngIf="imageError || !getImageUrl()" class="placeholder-image">
      <span>Imagen no disponible</span>
    </div>
    <div *ngIf="hasDiscount" class="discount-badge">
      -{{ getDiscountPercent() }}%
    </div>
    
    <!-- Bot贸n de edici贸n SOLO para modo administraci贸n -->
    <button 
      *ngIf="canEdit"
      [id]="'product-edit-button-' + getProductId()"
      class="edit-button"
      (click)="onEditProduct($event)"
      title="Editar producto"
      aria-label="Editar producto"
    >
      锔
    </button>
  </div>
  
  <div class="product-info">
    <!-- L铆nea 1: Variedad -->
    <h3 class="product-name" [title]="getName()">{{ getName() }}</h3>
    
    <!-- L铆nea 2: Disponible N unidades -->
    <p class="product-availability">Disponible: {{ getQuantity() }} {{ getUnitName() }}</p>
    
    <!-- L铆nea 3: Descripci贸n (m谩x 1-2 l铆neas con ellipsis) -->
    <p class="product-description" [title]="getDescription()">{{ getDescription() }}</p>
    
    <!-- L铆nea 4: Precio COP formateado -->
    <div class="price-section">
      <div *ngIf="hasDiscount" class="price-container">
        <span class="current-price">{{ formatPrice(discountedPrice) }}</span>
        <span class="original-price">{{ formatPrice(getPrice()) }}</span>
      </div>
      <div *ngIf="!hasDiscount" class="price-container">
        <span class="current-price">{{ formatPrice(getPrice()) }}</span>
      </div>
    </div>
    
    <!-- Botones de acci贸n (solo si no es modo edici贸n) -->
    <div *ngIf="!canEdit" class="action-buttons">
      <button 
        [id]="'btn-addcart-' + getProductId()"
        class="add-to-cart-button"
        (click)="onAddToCart($event)"
        [disabled]="getQuantity() <= 0"
        title="Agregar al carrito"
        aria-label="Agregar al carrito"
      >
         Agregar al carrito
      </button>
      <button 
        [id]="'btn-comprar-' + getProductId()"
        class="buy-button"
        (click)="onBuyNow($event)"
        [disabled]="getQuantity() <= 0"
        title="Comprar"
        aria-label="Comprar"
      >
         Comprar
      </button>
    </div>
  </div>
</div>
